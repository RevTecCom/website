<!DOCTYPE html>
<html> 
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="RocketCake">
	<title>RTC Daemonize</title>
	<style type="text/css">
		a { color:#5D5D9E; } 
		a:visited { color:#5D5D9E; } 
		a:active { color:#5C615E; } 
		a:hover { color:#B2B3B4; } 
		a.wsp16c06f69{ color:#4A4A4A; text-decoration: underline} 
		a.wsp16c06f69:visited{ color:#626262; text-decoration: underline} 
		a.wsp16c06f69:active{ color:#828282; text-decoration: underline} 
		a.wsp16c06f69:hover{ color:#2B2B2B; text-decoration: underline} 
		#menu_48e5ce68 a { text-decoration: none; }
		#menu_48e5ce68_pane { background-color: #E6E6E6; border: 1px solid #646464; padding-top: 10px; padding-bottom: 10px; box-shadow: 2px 2px 6px 0px rgba(8, 8, 8, 0.784314); }
		#menu_48e5ce68_hr { background-color: #646464; height: 1px; border: none; }
		#menu_48e5ce68_entry { padding-left: 10px; padding-right: 10px; padding-top: 3px; padding-bottom: 3px; }
		#menu_48e5ce68_entry:hover { background-color: #323232; color: #FFFFFF !important; }
		#menu_48e5ce68_entry:hover span { color:#FFFFFF !important; }
		.menu_48e5ce68_mainMenuEntry { text-align: center; }
		.menu_48e5ce68_mainMenuEntry:hover {	background-color:#282828; }
		.menu_48e5ce68_mainMenuEntry:hover span {	color:#FFFFFF !important; }
		#menu_48e5ce68 .mobileEntry { display: none; } 
		#menu_48e5ce68 .normalEntry { display: block; } 
		@media only screen and (max-width:550px) { 
			#menu_48e5ce68 .mobileEntry { display: block; } 
			#menu_48e5ce68 .normalEntry { display: none; } 
		}
	</style>
</head>
<body style="background-color:#FFFFFF; padding:0;  margin: 0;">
<div style="text-align:left;">
<img src="../assets/rtcbanner.png" width="1638" height="126" style="vertical-align: bottom; position:relative; display: inline-block; width:100%; background:none; height:auto; " id="img_16cc088c" alt="" title="" /><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/></span><div id="menu_48e5ce68" style="box-sizing: border-box; vertical-align: bottom; position:relative; display: inline-block; width:100%; height:31px; text-align:left; background-color:#A7A7A7; border-top: none; border-left: none; border-right: none; border-bottom: 1px solid #404040; "><div  style="position: relative; overflow: hidden; width: 100%; height: 100%;"><a href="javascript:void(0);">
	<div id="menuentry_50c4f776"  class="menu_48e5ce68_mainMenuEntry mobileEntry" style="position:absolute; width:37px; height:31px; left:10px; ">
		<div style="position:absolute; top:0px; bottom:0px; left:0px; right:0px; margin-top:auto; margin-bottom:auto; margin-left:auto; margin-right:auto; height:33px; ">
  <span style="font-size:22pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;">&#8801;</span>
		</div>
	</div>
</a>
<a href="../index.html" style="text-decoration:none">
	<div id="menuentry_6f726b76"  class="menu_48e5ce68_mainMenuEntry normalEntry" style="position:absolute; width:96px; height:31px; left:10px; ">
		<div style="position:absolute; top:0px; bottom:0px; left:0px; right:0px; margin-top:auto; margin-bottom:auto; margin-left:auto; margin-right:auto; height:18px; ">
  <span style="font-size:11pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold;  white-space: nowrap;">Homepage</span>
		</div>
	</div>
</a>
<a href="../join.html" style="text-decoration:none">
	<div id="menuentry_5c551743"  class="menu_48e5ce68_mainMenuEntry normalEntry" style="position:absolute; width:152px; height:31px; left:106px; ">
		<div style="position:absolute; top:0px; bottom:0px; left:0px; right:0px; margin-top:auto; margin-bottom:auto; margin-left:auto; margin-right:auto; height:18px; ">
  <span style="font-size:11pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold;  white-space: nowrap;">Become a Member</span>
		</div>
	</div>
</a>
<a href="../support.html" style="text-decoration:none">
	<div id="menuentry_1226b0ee"  class="menu_48e5ce68_mainMenuEntry normalEntry" style="position:absolute; width:155px; height:31px; left:258px; ">
		<div style="position:absolute; top:0px; bottom:0px; left:0px; right:0px; margin-top:auto; margin-bottom:auto; margin-left:auto; margin-right:auto; height:18px; ">
  <span style="font-size:11pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold;  white-space: nowrap;">Support Financially</span>
		</div>
	</div>
</a>
<a href="javascript:void(0);">
	<div id="menuentry_5f6d880e"  class="menu_48e5ce68_mainMenuEntry normalEntry" style="position:absolute; width:174px; height:31px; left:413px; ">
		<div style="position:absolute; top:0px; bottom:0px; left:0px; right:0px; margin-top:auto; margin-bottom:auto; margin-left:auto; margin-right:auto; height:18px; ">
  <span style="font-size:11pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold;  white-space: nowrap;">Texts and Documents</span>
		</div>
	</div>
</a>

	<script type="text/javascript" src="../assets/wsp_menu.js"></script>
	<script type="text/javascript">
		var js_menu_48e5ce68= new wsp_menu('menu_48e5ce68', 'menu_48e5ce68', 10);

		js_menu_48e5ce68.createMenuForItem('menuentry_50c4f776', ["  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Homepage</span> ", '../index.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Become a Member</span> ", '../join.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Support Financially</span> ", '../support.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Texts and Documents</span> ", 'javascript:void(0);', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">&#160;&#160;&#160;Organizational Documents</span> ", '../docs.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">&#160;&#160;&#160;News</span> ", '../periodical.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">&#160;&#160;&#160;Software Listing</span> ", '../clist.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">&#160;&#160;&#160;Other</span> ", '../other.html', '']);
		js_menu_48e5ce68.createMenuForItem('menuentry_6f726b76', []);
		js_menu_48e5ce68.createMenuForItem('menuentry_5c551743', []);
		js_menu_48e5ce68.createMenuForItem('menuentry_1226b0ee', []);
		js_menu_48e5ce68.createMenuForItem('menuentry_5f6d880e', ["  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Organizational Documents</span> ", '../docs.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">News</span> ", '../periodical.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Software Listing</span> ", '../clist.html', '',
		                                   "  <span style=\"font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000;  white-space: nowrap;\">Other</span> ", '../other.html', '']);

	</script>
</div></div><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/><br/></span>  </div>
<div style="text-align:center;">
<div style="vertical-align: top; position:relative; display: inline-block; width:80%; min-height:150px; background:none; " id="container_492a0a13"><div style="margin: 10px; display: block; " id="container_492a0a13_padding" ><div style="text-align:left;"><span style="font-size:16pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold; ">RTC Daemonize<br/></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">A reimplementation of the interface and idea behind Artem Boldariev&#8217;s Daemonize - made for fun, kept for everyone.<br/><br/>Did you know that there&#8217;s barely any standard for how background processes should work on Unix systems? It&#8217;s true! It&#8217;s all a mess! Everyone has different daemon implementations, and generally, the startup for most of them is a half-done mess, as no one can bother deciphering what half the things mean in this </span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><a href="https://www.man7.org/linux/man-pages/man7/daemon.7.html" class="wsp16c06f69">Linux manual page</a></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">. Did you know that whoever wrote it literally made it up from practice?<br/><br/>But worry not, for RTC Daemonize has come to save your wretched soul! This foolproof solution will ensure that you don&#8217;t have to spend another hour of your life (or three hours, if you&#8217;re like the writer of this page and have severe focus issues) choosing how to implement your daemon. If you also have a program that already uses the original Daemonize and want a Common Software replacement, you can pretty much use this as one.<br/><br/></span><span style="font-size:16pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold; ">The API<br/></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">RTC Daemonize provides two functions, with one being a wrapper on top of the other providing additional features. The first function is defined as:<br/><br/></span><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">pid_t daemonize(char flags);</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/><br/>This function is pretty self-explanatory: It daemonizes the program, while only implementing a subset of features required for a &#8220;true&#8221; SysV daemon (doesn&#8217;t write a file with its PID). The following flags, also present in the original Daemonize, are used to control the behaviour of the program:<br/><br/></span><ul id="ul_4a5a90a8" style="margin:0; font-size: 12pt; color:#000000; ">
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">DMN_DEFAULT</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Create daemon, close the existing file descriptors, reset signal handlers, change the current directory to /, set umask to 0.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">DMN_NO_CLOSE</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Do not close existing file descriptors and do not redirect standard file descriptors to /dev/null.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">DMN_KEEP_SIGNAL_HANDLERS</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Do not reset signal handlers to their defaults.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">DMN_NO_CHDIR</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Do not change the current directory of the daemon to /.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">DMN_NO_UMASK</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Do not set umask to 0.</span></ul>
</li>
<span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/>This function returns the PID of the daemon process to the parent process, and 0 to the daemon process. Its definition diverges slightly from the original specification, as here, the type used for flags is char, and not int. This shouldn&#8217;t break most programs.<br/><br/>The second function, which implements the full set of daemon behaviours, acts as a wrapper:<br/><br/></span><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">pid_t rundaemon(char flags,<br/>            int (*daemon_func)(void *udata),<br/>            void *udata,<br/>            int *exit_code,<br/>            const char *pid_file_path);</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/><br/>This function looks a little bit more complicated, let&#8217;s break it down:<br/><br/></span><ul id="ul_4365d317" style="margin:0; font-size: 12pt; color:#000000; ">
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">char flags </span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">- Flags that control daemon behaviour, same as above.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">int (*daemon_func)(void *udata)</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Function pointer to a function containing the daemon&#8217;s code, of type int, taking a void * as an argument.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">void *udata</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - A pointer to be passed to daemon_func, this can serve as a way to transfer data between the non-deamonized and deamonized parts of the program.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">int exit_code </span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">- Pointer to a variable which will be assigned the exit code of daemon_func.</span></li>
<li><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">const char *pid_file_path</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "> - Full pathname to the PID file, which is used for checking if the daemon is not already running, by checking if the PID inside the file exists. The file is created if it does not exist. This file is removed when the daemon terminates. The correct place to put this file is in /run/var, naming it the name of your daemon + .pid. Be aware that conforming to such a specification is only possible if the daemon is running as root. If the function cannot open a file due to lack of privileges, no checks will be performed.</span></ul>
</li>
<span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/></span><span style="font-size:16pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold; ">Example<br/></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">A daemon that prints a message to syslog, waits a minute, and then exits:<br/><br/></span><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">#include  &lt;syslog.h&gt;<br/>#include  &lt;unistd.h&gt;<br/>#include  &quot;daemonize.h&quot;<br/><br/>  <br/><br/>int daemon_main(void *udata) {<br/>    openlog(&quot;test&quot;, LOG_PID, LOG_DAEMON);<br/>    syslog(LOG_NOTICE, &quot;Hello, daemonic world!&quot;);<br/><br/>    sleep(60);<br/><br/>    closelog();<br/><br/>    return 0;<br/>}<br/><br/>  <br/><br/>int main(int  argc, char** argv){<br/>    int  testexit;<br/>    rundaemon(DMN_DEFAULT, daemon_main, NULL, &amp;testexit, &quot;/run/test.pid&quot;);<br/>}<br/><br/></span><span style="font-size:16pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold; ">Compliance<br/></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">The daemons created by this program follow the initialization specification of the Linux manpage to the point where the implementation is near functionally identical to the specification, with the single exception that, in RTC Daemonize, the double-fork is done directly, without opening a pipe for inter-process communication with the first parent before killing it later in the initialization. This change does not affect daemon functionality.<br/><br/></span><span style="font-size:16pt; font-family:Arial, Helvetica, sans-serif; color:#000000; font-weight:bold; ">Download and Compilation<br/></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">Current version: 1.1<br/></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><a href="downloads/daemonize.zip" class="wsp16c06f69">Download it here</a></span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; ">.<br/><br/>MD5 Checksums for the files:<br/><br/></span><span style="font-size:12pt; font-family:'Lucida Console', Monaco, monospace; color:#000000; ">1932c7fd7dc3657245a4304696c91d46  compile.sh<br/>975e83a177f119aacd33f492804a861e  daemonize.c<br/>f725d7343b31049413e78f5568a6ac2f  daemonize.h</span><span style="font-size:12pt; font-family:Arial, Helvetica, sans-serif; color:#000000; "><br/><br/>After downloading and unzipping, compile with the compile.sh script. It will generate a static library, which is what you should really be using this as. It is recommended that your default C compiler (cc) be clang, but most standards-compliant compilers should work, including gcc.</span></div>
</div></div>  </div>
</body>
</html>